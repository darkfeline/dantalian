

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Libraries &mdash; dantalian 0.5-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.5-dev documentation" href="../index.html" />
    <link rel="up" title="User Guide" href="../user.html" />
    <link rel="next" title="FUSE" href="fuse.html" />
    <link rel="prev" title="Hard Links Tutorial" href="links.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fuse.html" title="FUSE"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="links.html" title="Hard Links Tutorial"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../user.html" accesskey="U">User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="libraries">
<h1>Libraries<a class="headerlink" href="#libraries" title="Permalink to this headline">¶</a></h1>
<p>Libraries are the fundamental level of abstraction in dantalian.  A
library is an abstract tag-based file organization system layered
transparently on top of the underlying file system using hard links.
Libraries are created on directories, which become the root for its
library.  A special <tt class="docutils literal"><span class="pre">.dantalian</span></tt> directory is created in the root
directory.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">I&#8217;ve said it before, but it bears repeating: dantalian uses hard
links heavily.  Make sure you are familiar with how hard links work!
They are very powerful, but can be messy and/or dangerous if you are
not familiar with them.  Especially take care not to accidently break
hard links, e.g. by copying and removing files.  dantalian leverages
the advantages hard links provide, but won&#8217;t protect you from
yourself!</p>
</div>
<p>Tags are directories, and all directories are potential tags (except
<tt class="docutils literal"><span class="pre">.dantalian</span></tt>, a special directory)  Files are &#8220;tagged&#8221; by creating a
hard link in the respective directory.  Files can have any number and
combination of tags.  File names and tag names are restricted only by
the underlying file system (on ext4, for example, up to 255 bytes
and all characters except <tt class="docutils literal"><span class="pre">/</span></tt> are allowed, so knock yourself out).
All files of all types can be tagged, including symlinks.  dantalian
provides functionality such that even directories can be tagged, perfect
for hardcore file organizers.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>While it is possible to manage the library abstraction solely using
standard programs such as <tt class="docutils literal"><span class="pre">ln</span></tt>, <tt class="docutils literal"><span class="pre">mv</span></tt>, etc., dantalian provides
useful scripts for performing operations such as tagging, untagging, and
deleting, as commands for the command-line script <tt class="docutils literal"><span class="pre">dantalian</span></tt>.</p>
<p>See the manpage (linked here: <a class="reference internal" href="../manpage.html#manpage"><em>dantalian - dantalian cli script</em></a>) for the commands for
<tt class="docutils literal"><span class="pre">dantalian</span></tt>.</p>
</div>
<div class="section" id="specific-requirements">
<h2>Specific Requirements<a class="headerlink" href="#specific-requirements" title="Permalink to this headline">¶</a></h2>
<p>There are some requirements for libraries:</p>
<ol class="arabic simple">
<li>The root directory must be located on a POSIX filesystem that
supports hard links (e.g., <tt class="docutils literal"><span class="pre">ext4</span></tt>).</li>
<li>Everything under the root directory must be on one file system.</li>
<li>Do funky things with device mounts at your own risk.  This includes
mounting another device inside a library, mounting a different
library FUSE (more on this in <a class="reference internal" href="fuse.html#fuse"><em>FUSE</em></a>) in a library, and mounting
the same library FUSE in itself.  Don&#8217;t do it.</li>
</ol>
<p>While the above may seem complicated, for most users, it should not be a
problem.  If you run into the above situations, chances are, you&#8217;re an
advanced enough user to figure out why and how to fix them.</p>
</div>
<div class="section" id="name-conflicts">
<span id="id1"></span><h2>Name conflicts<a class="headerlink" href="#name-conflicts" title="Permalink to this headline">¶</a></h2>
<p>Files are hard linked under the tags that it possesses.  The file may
have different names in each of the directories, e.g. to avoid name
conflicts.  dantalian provides &#8220;partial&#8221; support for files having
different names.  The library abstraction is completely sound in this
case, but certain features may not work, or may be less useful or harder
to work with.  dantalian finds files by the path to one of its hard
links and manages them internally by hard link references and inodes.</p>
<p>Currently, dantalian is unable to tag a file if a file with the same
name exists in that location (this feature will be implemented later).
However, you can manually hard link the file with a different name and
dantalian will work perfectly.</p>
<p>See <a class="reference internal" href="../dev/names.html#names"><em>Names and Paths</em></a> for more information.</p>
</div>
<div class="section" id="tagging-directories">
<h2>Tagging Directories<a class="headerlink" href="#tagging-directories" title="Permalink to this headline">¶</a></h2>
<p>Directories generally are not allowed to be hard linked in most file
systems, for various reasons.  However, symbolic links are regular files
and thus can be hard linked, even if they point to a directory.
dantalian leverages this, but care should be taken.</p>
<p>dantalian can convert directories.  Converting a directory moves it to a
special location under <tt class="docutils literal"><span class="pre">.dantalian</span></tt> and replaces it with an absolute
symbolic link to its new location.  This allows directories to be tagged
just like other files.</p>
<p>This feature imposes an extra requirement on the library root directory.
Namely, when the root directory path is changed, the symbolic links of
all converted directories must be fixed by running <tt class="docutils literal"><span class="pre">dantalian</span> <span class="pre">fix</span></tt>.
Also, unlike regular files, which can be freely hard linked to
directories outside of the library (and tagged in other libraries), if
you hard link the symbolic link of a dantalian-converted directory
outside of it, move the library, and run <tt class="docutils literal"><span class="pre">dantalian</span> <span class="pre">fix</span></tt>, it will
break the external hard links.  If this is one of your use cases, place
the directories in a fixed location outside of the library, create a
symlink, and then tag it with dantalian instead of using <tt class="docutils literal"><span class="pre">dantalian</span>
<span class="pre">convert</span></tt>.  <tt class="docutils literal"><span class="pre">dantalian</span> <span class="pre">convert</span></tt> is best used for tagging tags; you
<em>can</em> use it for tagging directories (e.g., scanned books, entire albums
as a single unit), but if you forsee moving the library and hard linking
the symlinks elsewhere, use the method mentioned above.</p>
<p>Because converted directories are all kept in one location, no two
converted directories may have the same name.  However, the name of the
directory dantalian keeps track of and the name of the symbolic link
that users will be interacting with are separate.  Thus, if there&#8217;s a
naming conflict, the actual directory can be renamed, and the symbolic
links follow the naming rules as above.</p>
</div>
<div class="section" id="moving-libraries">
<h2>Moving Libraries<a class="headerlink" href="#moving-libraries" title="Permalink to this headline">¶</a></h2>
<p>Since libraries are simply directories, moving and/or backing up
libraries is very simple.  There are two thing to keep in mind:  use
<tt class="docutils literal"><span class="pre">rsync</span> <span class="pre">-H</span></tt> to preserve hard links, and don&#8217;t forget to run <tt class="docutils literal"><span class="pre">dantalian</span>
<span class="pre">fix</span></tt> to fix absolute symbolic links for converted directories.  The
latter is extremely important as dantalian currently will <em>not</em> check if
it needs fixing, so you may potentially break your library.</p>
</div>
<div class="section" id="nested-libraries">
<h2>Nested Libraries<a class="headerlink" href="#nested-libraries" title="Permalink to this headline">¶</a></h2>
<p>Only one library can exist in any given directory, but libraries can be
nested.  Behavior is well-defined, but I wouldn&#8217;t recommend it unless
you have a clear use case and know what you are doing.  <tt class="docutils literal"><span class="pre">dantalian</span></tt>
works with a single library for its operations.  Usually, it will search
up through the directories and use the first library it finds, so take
care where you run it.  You can also specify a specific library by
using the <tt class="docutils literal"><span class="pre">--root</span></tt> option.  In fact, if you are nesting libraries, it
is recommended to <em>always</em> use <tt class="docutils literal"><span class="pre">--root</span></tt>.</p>
</div>
<div class="section" id="scalability">
<h2>Scalability<a class="headerlink" href="#scalability" title="Permalink to this headline">¶</a></h2>
<p>dantalian&#8217;s scalability ultimately depends on the host file system, but
is generally pretty lenient.  On ext4, for example, the main limiting
factor is number of files per directory, i.e., the number of files that
have a given tag.  dantalian remains usable no matter the number, but if
you have, say, more than 10,000 files with a given tag, <tt class="docutils literal"><span class="pre">ls</span></tt>
(specifically <tt class="docutils literal"><span class="pre">readdir()</span></tt> on the kernel level) may begin to see
performance issues.  However, file access will not be affected.</p>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Libraries</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#specific-requirements">Specific Requirements</a></li>
<li><a class="reference internal" href="#name-conflicts">Name conflicts</a></li>
<li><a class="reference internal" href="#tagging-directories">Tagging Directories</a></li>
<li><a class="reference internal" href="#moving-libraries">Moving Libraries</a></li>
<li><a class="reference internal" href="#nested-libraries">Nested Libraries</a></li>
<li><a class="reference internal" href="#scalability">Scalability</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="links.html"
                        title="previous chapter">Hard Links Tutorial</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fuse.html"
                        title="next chapter">FUSE</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/user/library.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fuse.html" title="FUSE"
             >next</a> |</li>
        <li class="right" >
          <a href="links.html" title="Hard Links Tutorial"
             >previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../user.html" >User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>