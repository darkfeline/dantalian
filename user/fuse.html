

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FUSE &mdash; dantalian 0.5-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.5-dev documentation" href="../index.html" />
    <link rel="up" title="User Guide" href="../user.html" />
    <link rel="next" title="Bugs" href="bugs.html" />
    <link rel="prev" title="Libraries" href="library.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="bugs.html" title="Bugs"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="library.html" title="Libraries"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../user.html" accesskey="U">User Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fuse">
<span id="id1"></span><h1>FUSE<a class="headerlink" href="#fuse" title="Permalink to this headline">¶</a></h1>
<p>dantalian offers an optional FUSE mount feature, which allows much more
powerful interaction with libraries.</p>
<p>To use it, run <tt class="docutils literal"><span class="pre">dantalian</span> <span class="pre">mount</span> <span class="pre">/path/to/mount/location</span></tt> on the
command line.  You will want to mount it somewhere outside of the
library.</p>
<p>In addition to projecting the library into virtual FUSE space, you will
also be able to set up virtual tag groups, which represent the
intersection of a set of tags.  The two configuration files are
<tt class="docutils literal"><span class="pre">.dantalian/mount</span></tt> and <tt class="docutils literal"><span class="pre">.dantalian/mount_custom</span></tt>.  If the latter
exists, it will be used; otherwise the former is used.  The first
configuration file is in JSON, and should look as follows:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span>
    <span class="p">{</span><span class="s">&quot;mount&quot;</span><span class="p">:</span> <span class="s">&quot;/path/to/mount/location&quot;</span><span class="p">,</span>
     <span class="s">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;tag1&quot;</span><span class="p">,</span> <span class="s">&quot;tag2&quot;</span><span class="p">,</span> <span class="s">&quot;tag3&quot;</span><span class="p">]},</span>
    <span class="p">{</span><span class="s">&quot;mount&quot;</span><span class="p">:</span> <span class="s">&quot;/path/to/another/mount&quot;</span><span class="p">,</span>
     <span class="s">&quot;tags&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s">&quot;more&quot;</span><span class="p">,</span> <span class="s">&quot;tags&quot;</span><span class="p">]}</span>
<span class="p">]</span>
</pre></div>
</div>
<p>Alternately, you may provide a custom script, <tt class="docutils literal"><span class="pre">mount_custom</span></tt>.  It
should be a Python module that contains a function with the signature
<tt class="docutils literal"><span class="pre">maketree(root)</span></tt>.  It will be passed the root of the library.  You may
write your own script to set up a node tree and return it, and dantalian
will handle the rest.  See <tt class="xref py py-meth docutils literal"><span class="pre">dantalian.library._maketree()</span></tt> to see
how dantalian creates a node tree from the JSON for an example.</p>
<div class="section" id="usage">
<h2>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h2>
<p>For the most part, FUSE-mounted libraries behave exactly like regular
libraries, so you can use the regular dantalian commands as well as
regular file system operations to interact with it.  However, certain
dantalian commands behave differently or are restricted for sanity&#8217;s
sake (for example, you cannot <tt class="docutils literal"><span class="pre">mount</span></tt> a FUSE-mounted library).
dantalian distinguishes between a mounted library and a regular library
by a virtual directory <tt class="docutils literal"><span class="pre">.dantalian-fuse</span></tt>, which simply points to
<tt class="docutils literal"><span class="pre">.dantalian</span></tt>.</p>
<p>To unmount, use <tt class="docutils literal"><span class="pre">fusermount</span> <span class="pre">-u</span> <span class="pre">path/to/mount</span></tt>.</p>
<p>See <a class="reference internal" href="../dev/names.html#names"><em>Names and Paths</em></a> for more information.</p>
</div>
<div class="section" id="nodes-and-virtual-space">
<h2>Nodes and virtual space<a class="headerlink" href="#nodes-and-virtual-space" title="Permalink to this headline">¶</a></h2>
<p>dantalian manages the virtual space using a node tree.  Inheritance tree
of nodes:</p>
<ul class="simple">
<li>FSNode<ul>
<li>BorderNode<ul>
<li>TagNode</li>
<li>RootNode</li>
</ul>
</li>
</ul>
</li>
</ul>
<p>FSNodes simply represent virtual directories.  BorderNode is an abstract
subclass for nodes that lead back into real space (back to the
underlying file system).  There are two types: TagNodes project the
intersection of their tags under themselves, whereas the RootNode (there
will only be one) projects the library root under itself.</p>
<p>Functionally, it is useful to divide the virtual space into categories.
Paths which point to nodes will be called nodespace.  Paths which point
to files directly under TagNodes are tagspace.  Paths which point more
than one directory beyond TagNodes or any files under RootNodes are
outsidespace.</p>
</div>
<div class="section" id="name-conflicts">
<h2>Name conflicts<a class="headerlink" href="#name-conflicts" title="Permalink to this headline">¶</a></h2>
<p>Specified mounts (nodes) will obscure any files or directories with the
same name under RootNode.</p>
<p>File name conflicts for files under TagNodes will be resolved by adding
the inode number (which is guaranteed to be unique) at the end of the
file name, but before the extension.  E.g., if two files are both named
<tt class="docutils literal"><span class="pre">file.mp3</span></tt>, the latter will appear as <tt class="docutils literal"><span class="pre">file.12345.mp3</span></tt>, assuming its
inode number is <tt class="docutils literal"><span class="pre">12345</span></tt>.</p>
</div>
<div class="section" id="socket-operations">
<h2>Socket Operations<a class="headerlink" href="#socket-operations" title="Permalink to this headline">¶</a></h2>
<p>You can also interact directly with a FUSE-mounted library using socket
operations.  FUSE-mounted libraries open a socket at
<tt class="docutils literal"><span class="pre">.dantalian/fuse.sock</span></tt>.  dantalian provides scripts that allow you to
interact dynamically with a mounted library, but they simply echo
standard commands to the socket, which can be done by hand (like all
other dantalian operations) from, e.g. a remote client that doesn&#8217;t have
dantalian installed.  For example, the socket command:</p>
<div class="highlight-python"><pre>$ dantalian mknode path/to/node tag1 tag2</pre>
</div>
<p>can be done by:</p>
<div class="highlight-python"><pre>$ echo mknode path/to/node tag1 tag2 &gt; library/.dantalian/fuse.sock</pre>
</div>
<p>The socket processes commands much like a shell, so make sure to quote
anything that contains spaces.</p>
<p>Currently, the only socket command is <tt class="docutils literal"><span class="pre">mknode</span></tt>, which dynamically adds
a TagNode.</p>
</div>
<div class="section" id="fuse-operations">
<h2>FUSE Operations<a class="headerlink" href="#fuse-operations" title="Permalink to this headline">¶</a></h2>
<p>FUSE intercepts calls to the kernel to perform file system operations,
allowing it to present a file system API in user space.  How it behaves
depends on how these operations are implemented.  See below for the
implemented operations and their behavior.  As a rule of thumb,
interaction with nodespace is extremely limited.  Calls to outsidespace
will be passed on to the OS/underlying file system.  Calls to tagspace
will manipulate the tags on the files according to the library paradigm.</p>
<dl class="class">
<dt id="dantalian.operations.TagOperations">
<em class="property">class </em><tt class="descclassname">dantalian.operations.</tt><tt class="descname">TagOperations</tt><big>(</big><em>root</em>, <em>tree</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations" title="Permalink to this definition">¶</a></dt>
<dd><dl class="function">
<dt id="dantalian.operations.TagOperations.chmod">
<tt class="descname">chmod</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.chmod" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.chown">
<tt class="descname">chown</tt><big>(</big><em>self</em>, <em>path</em>, <em>uid</em>, <em>gid</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.chown" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.create">
<tt class="descname">create</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.create" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is tagged,
additionally add its tags.  If <cite>path</cite> is a node, the operation is
invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.getattr">
<tt class="descname">getattr</tt><big>(</big><em>self</em>, <em>path</em>, <em>fh=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.getattr" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
get attributes from node.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.link">
<tt class="descname">link</tt><big>(</big><em>self</em>, <em>source</em>, <em>target</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.link" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this is different from standard.  Usually link(a, b) creates
a link at a to b, but this link(source, target) creates a link at
source to target.</p>
<p>If <cite>source</cite> is tagged, tag it.  If <cite>source</cite> is outside, link it.  If
<cite>source</cite> is a node, raise EINVAL</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.mkdir">
<tt class="descname">mkdir</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.mkdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If it is tagged,
additionally convert it and add tags.  If <cite>path</cite> is a node, the
operation is invalid and raises EINVAL.</p>
<p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
<p>If <cite>path</cite> points beyond a node, forward the request to the OS (via
built-in os module).  Once a directory is created, it is converted and
tagged with all of the tags of the furthest node.  Otherwise the
operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.open">
<tt class="descname">open</tt><big>(</big><em>self</em>, <em>path</em>, <em>flags</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.open" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.read">
<tt class="descname">read</tt><big>(</big><em>self</em>, <em>path</em>, <em>size</em>, <em>offset</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.read" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>path</cite> is ignored.  Forward the request to the OS (via built-in os
module) with the file descriptor.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.readdir">
<tt class="descname">readdir</tt><big>(</big><em>self</em>, <em>path</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.readdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
a directory listing containing &#8216;.&#8217; and &#8216;..&#8217; is made and generated
entries from the node&#8217;s __iter__ are added.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.readlink">
<tt class="descname">readlink</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.readlink" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.rename">
<tt class="descname">rename</tt><big>(</big><em>self</em>, <em>old</em>, <em>new</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>This one is tricky; here&#8217;s a handy chart.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="16%" />
<col width="34%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old</th>
<th class="head">To Node</th>
<th class="head">To Tagged</th>
<th class="head">To Outside</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Node</td>
<td>EINVAL</td>
<td>EINVAL</td>
<td>EINVAL</td>
</tr>
<tr class="row-odd"><td>Tagged</td>
<td>EINVAL</td>
<td>untag, tag</td>
<td>move, untag</td>
</tr>
<tr class="row-even"><td>Outside</td>
<td>EINVAL</td>
<td>tag, remove</td>
<td>move</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.rmdir">
<tt class="descname">rmdir</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.rmdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  (If it&#8217;s tagged, it&#8217;s
not a dir, but we&#8217;ll let the OS handle that =))  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.statfs">
<tt class="descname">statfs</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.statfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward the request to the OS (via built-in os module).</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.symlink">
<tt class="descname">symlink</tt><big>(</big><em>self</em>, <em>source</em>, <em>target</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.symlink" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this is different from standard.  Usually link(a, b) creates
a link at a to b, but this link(source, target) creates a link at
source to target.</p>
<p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.truncate">
<tt class="descname">truncate</tt><big>(</big><em>self</em>, <em>path</em>, <em>length</em>, <em>fh=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.truncate" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If it is tagged,
additionally add its tags.  If <cite>path</cite> is a node, the operation is
invalid and raises EINVAL. <cite>fh</cite> is ignored.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.unlink">
<tt class="descname">unlink</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.unlink" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is tagged, untag.  If <cite>path</cite> is outside, forward to OS.  If
<cite>path</cite> is a node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.utimens">
<tt class="descname">utimens</tt><big>(</big><em>self</em>, <em>path</em>, <em>times=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.utimens" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.write">
<tt class="descname">write</tt><big>(</big><em>self</em>, <em>path</em>, <em>data</em>, <em>offset</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.write" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a node,
the operation is invalid and raises EINVAL.  <cite>fh</cite> is used; <cite>path</cite> is
only used for verification.</p>
</dd></dl>

</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FUSE</a><ul>
<li><a class="reference internal" href="#usage">Usage</a></li>
<li><a class="reference internal" href="#nodes-and-virtual-space">Nodes and virtual space</a></li>
<li><a class="reference internal" href="#name-conflicts">Name conflicts</a></li>
<li><a class="reference internal" href="#socket-operations">Socket Operations</a></li>
<li><a class="reference internal" href="#fuse-operations">FUSE Operations</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="library.html"
                        title="previous chapter">Libraries</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="bugs.html"
                        title="next chapter">Bugs</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/user/fuse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="bugs.html" title="Bugs"
             >next</a> |</li>
        <li class="right" >
          <a href="library.html" title="Libraries"
             >previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../user.html" >User Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>