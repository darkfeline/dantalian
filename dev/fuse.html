

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>FUSE/Mounted Library Specification &mdash; dantalian 0.5-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.5-dev documentation" href="../index.html" />
    <link rel="up" title="Developer Guide" href="../dev.html" />
    <link rel="next" title="Changelog" href="../changes.html" />
    <link rel="prev" title="Library Implementation" href="libop.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../changes.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="libop.html" title="Library Implementation"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../dev.html" accesskey="U">Developer Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="fuse-mounted-library-specification">
<h1>FUSE/Mounted Library Specification<a class="headerlink" href="#fuse-mounted-library-specification" title="Permalink to this headline">¶</a></h1>
<p>The dantalian library API requires a <tt class="xref py py-meth docutils literal"><span class="pre">mount()</span></tt> method, which uses
FUSE to mount a virtual file system representation of the library.</p>
<p>The mounted library provides a standard file-system-like interface to
libraries.  While the dantalian implementation of the library already
provides such an interface, other implementations may not by default.
Also, mounted libraries provide additional features even for dantalian&#8217;s
existing file-system-like interface.</p>
<div class="section" id="virtual-spaces">
<h2>Virtual Spaces<a class="headerlink" href="#virtual-spaces" title="Permalink to this headline">¶</a></h2>
<p>In describing mounted library behavior, it is useful to divide the file
system space into a number of categories.</p>
<p>Directories corresponding to nodes are considered to be in virtual
space.  (Nodes are virtual space.)</p>
<p>Directories and files corresponding to real directories and files on the
file system are considered to be in real space.</p>
<p>There is also a subcategory for directories and files in real space:
real space files and directories pulled in by TagNodes are additionally
considered to be in tag space.  Note that this is not recursive.  Given
the following:</p>
<div class="highlight-python"><pre>TagNode/
   dir1/
      file1
   dir2/
   file2</pre>
</div>
<p>TagNode is in virtual space as it is a node.  Everything under it is in
real space, but only <tt class="docutils literal"><span class="pre">dir1</span></tt>, <tt class="docutils literal"><span class="pre">dir2</span></tt>, and <tt class="docutils literal"><span class="pre">file2</span></tt> are in tag space.
<tt class="docutils literal"><span class="pre">file1</span></tt> is not in tag space.</p>
</div>
<div class="section" id="fuse-operations">
<h2>FUSE Operations<a class="headerlink" href="#fuse-operations" title="Permalink to this headline">¶</a></h2>
<p>FUSE provides syscall-like operation hooks to emulate a file system.
Their implementations for mounted libraries are found as methods in the
<tt class="xref py py-class docutils literal"><span class="pre">dantalian.operations.TagOperations</span></tt> class.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The behavior of the following operations on tag space is subject to
change, due to planned additions to tag nodes.</p>
</div>
<dl class="method">
<dt>
<tt class="descname">chmod</tt><big>(</big><em>path</em>, <em>mode</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real or tag space, forward to OS.  If <cite>path</cite> is in
virtual space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">chown</tt><big>(</big><em>path</em>, <em>uid</em>, <em>gid</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real or tag space, forward to OS.  If <cite>path</cite> is in
virtual space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">create</tt><big>(</big><em>path</em>, <em>mode</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is also in tag
space, tag the file accordingly. If <cite>path</cite> is in virtual space, the
operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">getattr</tt><big>(</big><em>path</em>, <em>fh=None</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real or tag space, forward to OS.  If <cite>path</cite> is in
virtual space, get file attributes from the node.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">getxattr</tt><big>(</big><big>)</big></dt>
<dd><p>Not implemented.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">listxattr</tt><big>(</big><big>)</big></dt>
<dd><p>Not implemented.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">link</tt><big>(</big><em>source</em>, <em>target</em><big>)</big></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">Note that this is different from standard.  Usually link(a, b)
creates a link at <cite>b</cite> to <cite>a</cite>, but this link(source, target)
creates a link at <cite>source</cite> to <cite>target</cite>.  This is a quirk in the
FUSE library used in dantalian.</p>
</div>
<p>If <cite>source</cite> is in real space, link it (forward request to OS).  If
<cite>source</cite> is also in tag space, tag the newly created link
accordingly.  If <cite>source</cite> is in virtual space, raise EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">mkdir</tt><big>(</big><em>path</em>, <em>mode</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is also in tag
space, additionally convert the new directory and tag it accordingly.
If <cite>path</cite> is in virtual space, the operation is invalid and raises
EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">open</tt><big>(</big><em>path</em>, <em>flags</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">read</tt><big>(</big><em>path</em>, <em>size</em>, <em>offset</em>, <em>fh</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">readdir</tt><big>(</big><em>path</em>, <em>fh</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, get information from the node.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">readlink</tt><big>(</big><em>path</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">removexattr</tt><big>(</big><big>)</big></dt>
<dd><p>Not implemented.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">rename</tt><big>(</big><em>old</em>, <em>new</em><big>)</big></dt>
<dd><p>This one is tricky; here&#8217;s a handy chart.</p>
<table border="1" class="docutils">
<colgroup>
<col width="26%" />
<col width="19%" />
<col width="28%" />
<col width="28%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">From To -&gt;</th>
<th class="head">Virtual</th>
<th class="head">Tag</th>
<th class="head">Real</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Virtual</td>
<td>EINVAL</td>
<td>EINVAL</td>
<td>EINVAL</td>
</tr>
<tr class="row-odd"><td>Tag</td>
<td>EINVAL</td>
<td>untag, tag</td>
<td>move, untag</td>
</tr>
<tr class="row-even"><td>Real</td>
<td>EINVAL</td>
<td>tag, remove</td>
<td>move</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">rmdir</tt><big>(</big><em>path</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">setxattr</tt><big>(</big><big>)</big></dt>
<dd><p>Not implemented.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">statfs</tt><big>(</big><em>path</em><big>)</big></dt>
<dd><p>Forward the request to the OS (via built-in os module).</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">symlink</tt><big>(</big><em>source</em>, <em>target</em><big>)</big></dt>
<dd><div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">This has the same quirk as <cite>link()</cite>.</p>
</div>
<p>If <cite>source</cite> is in real space, link it (forward request to OS).  If
<cite>source</cite> is also in tag space, tag the newly created symlink.  If
<cite>source</cite> is in virtual space, raise EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">truncate</tt><big>(</big><em>path</em>, <em>length</em>, <em>fh=None</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real or tag space, forward to OS.  If <cite>path</cite> is in
virtual space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">unlink</tt><big>(</big><em>path</em><big>)</big></dt>
<dd><p>If <cite>source</cite> is in real space, but not tag space, forward to OS.  If
<cite>source</cite> is in tag space, untag the file instead.  If <cite>source</cite> is in
virtual space, raise EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">utimens</tt><big>(</big><em>path</em>, <em>times=None</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">write</tt><big>(</big><em>path</em>, <em>data</em>, <em>offset</em>, <em>fh</em><big>)</big></dt>
<dd><p>If <cite>path</cite> is in real space, forward to OS.  If <cite>path</cite> is in virtual
space, the operation is invalid and raises EINVAL.</p>
</dd></dl>

</div>
<div class="section" id="nodes">
<h2>Nodes<a class="headerlink" href="#nodes" title="Permalink to this headline">¶</a></h2>
<p>Nodes are used to construct and maintain the virtual library file
system.  Internally, nodes are implemented as mapping type data objects.</p>
<p>Currently, there are three node types and one virtual node class.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BaseNode</span></tt> is the fundamental node class,
representing a virtual directory in a mounted library.  Its
implementation is <tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.Node</span></tt>.</p>
<p><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BorderNode</span></tt> is a virtual class/interface for
nodes that pull the host file system into the virtual space (i.e.,
tagged files)</p>
<p>It has two subclasses, <tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BaseRootNode</span></tt> and
<tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BaseTagNode</span></tt>, and their implementations
<tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.RootNode</span></tt> and <tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.TagNode</span></tt>,
respectively.</p>
<p>RootNodes pull all of the tags in the library under themselves as
virtual directories.  They will usually be the root node for the node
trees that describe the mounted library structure, but this is not
necessary.</p>
<p>TagNodes pull the intersection set of files of a given set of tags under
themselves.</p>
</div>
<div class="section" id="node-file-attributes">
<h2>Node File Attributes<a class="headerlink" href="#node-file-attributes" title="Permalink to this headline">¶</a></h2>
<p>Nodes implement a basic set of default file attributes.</p>
<dl class="docutils">
<dt>atime, ctime, mtime</dt>
<dd>Defaults to time of node creation</dd>
<dt>uid, gid</dt>
<dd>Defaults to process&#8217;s uid and gid</dd>
<dt>mode</dt>
<dd>Set directory bit, and permission bits 0o777 minus umask bits.</dd>
<dt>size</dt>
<dd>Constant 4096</dd>
</dl>
<p>Currently these are dummy values and do not change, save for nlinks.</p>
</div>
<div class="section" id="socket-commands">
<h2>Socket Commands<a class="headerlink" href="#socket-commands" title="Permalink to this headline">¶</a></h2>
<p>Socket commands allow interaction with the mounted FUSE process, thereby
dynamically modifying parts of the virtual FUSE-mounted library.  Socket
commands may be invoked by the relevant commands of the dantalian CLI
script, or by <tt class="docutils literal"><span class="pre">echo</span></tt>ing the commands directly into the FUSE library
socket.  The dantalian CLI script simply writes the commands to the
socket as well.</p>
<p>Currently, there are the following commands:</p>
<dl class="docutils">
<dt>mknode path tag1 [tag2 ...]</dt>
<dd>Make a TagNode at the given path with the given tags.  Make
intermediary Nodes if needed.</dd>
<dt>rmnode path</dt>
<dd>Remove the Node at the given path.</dd>
</dl>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">FUSE/Mounted Library Specification</a><ul>
<li><a class="reference internal" href="#virtual-spaces">Virtual Spaces</a></li>
<li><a class="reference internal" href="#fuse-operations">FUSE Operations</a></li>
<li><a class="reference internal" href="#nodes">Nodes</a></li>
<li><a class="reference internal" href="#node-file-attributes">Node File Attributes</a></li>
<li><a class="reference internal" href="#socket-commands">Socket Commands</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="libop.html"
                        title="previous chapter">Library Implementation</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../changes.html"
                        title="next chapter">Changelog</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/dev/fuse.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../changes.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="libop.html" title="Library Implementation"
             >previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../dev.html" >Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>