

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>dantalian Package &mdash; dantalian 0.5-dev documentation</title>
    
    <link rel="stylesheet" href="../../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../',
        VERSION:     '0.5-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.5-dev documentation" href="../../index.html" />
    <link rel="up" title="API Reference" href="../api.html" />
    <link rel="next" title="Changelog" href="../../changes.html" />
    <link rel="prev" title="API Reference" href="../api.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../changes.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="../api.html" title="API Reference"
             accesskey="P">previous</a> |</li>
        <li><a href="../../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../../dev.html" >Developer Guide</a> &raquo;</li>
          <li><a href="../api.html" accesskey="U">API Reference</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="dantalian-package">
<h1>dantalian Package<a class="headerlink" href="#dantalian-package" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-dantalian.commands">
<span id="commands-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">commands</span></tt> Module<a class="headerlink" href="#module-dantalian.commands" title="Permalink to this headline">¶</a></h2>
<p>All the functions in this module are hooked in the dantalian script as
commands.  See the manpage for usage.</p>
<p>Commands should be decorated appropriately.  All of them should have
<tt class="docutils literal"><span class="pre">&#64;_public</span></tt>.  <tt class="docutils literal"><span class="pre">&#64;_global</span></tt> is for global commands, which take no
additional parameters.  <tt class="docutils literal"><span class="pre">&#64;_library</span></tt> commands get a Library instance.
<tt class="docutils literal"><span class="pre">&#64;_sock</span></tt> commands get a socket object.</p>
<p>This module enables external Python applications to execute dantalian
commands directly without having to use <tt class="xref py py-mod docutils literal"><span class="pre">subprocess</span></tt> or going
through the command line script.</p>
<dl class="function">
<dt id="dantalian.commands.tag">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">tag</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Tag file.</p>
<p>Tag <cite>file</cite> with <cite>tag</cite> (Hard links <cite>file</cite> under <cite>tag</cite> directory with
the same name).  If <cite>file</cite> is already tagged, does nothing.  If
<cite>file</cite> is a directory, you&#8217;ll need to convert it first.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.untag">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">untag</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.untag" title="Permalink to this definition">¶</a></dt>
<dd><p>Untag file.</p>
<p>Remove tag <cite>tag</cite> from <cite>file</cite> (Removes the hard link to <cite>file</cite> under
<cite>tag</cite> directory).  If <cite>file</cite> isn&#8217;t tagged, does nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.tags">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">tags</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.tags" title="Permalink to this definition">¶</a></dt>
<dd><p>List tags.</p>
<p>List all the tags of <cite>file</cite> (Lists the directories that have hard
links to <cite>file</cite>).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.find">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">find</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Find files with tags.</p>
<p>Intersect tag search.  Lists all files that have all of the given
tags.  Lists files by the path to the hard link under the first tag
given.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.rm">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">rm</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.rm" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove file.</p>
<p>Remove the files given (Removes all hard links to the files under
the root directory).</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.rename">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">rename</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename file.</p>
<p>Rename all hard links of <cite>file</cite> to <cite>new</cite>.  New names are subject to
name collision resolution.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.convert">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">convert</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert directory.</p>
<p>Convert directories so they can be tagged.  (Move directories to
special location &#8216;.dantalian/dirs&#8217; and replace the original with a
symlink pointing to the absolute path.)</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.fix">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">fix</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.fix" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix symlinks.</p>
<p>Fix symlinks after the library has been moved.  If it hasn&#8217;t been
moved, do nothing.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.clean">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">clean</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.clean" title="Permalink to this definition">¶</a></dt>
<dd><p>Clean converted directories.</p>
<p>Internally tracked converted directories which no longer have
referent symlink under the root directory are removed.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.init">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">init</tt><big>(</big><em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.init" title="Permalink to this definition">¶</a></dt>
<dd><p>Create and initialize a library.</p>
<p>Create a library in <cite>dir</cite>.  If <cite>dir</cite> is omitted, create a library in
the current directory.  If a library already exists, it is not
affected.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.mount">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">mount</tt><big>(</big><em>lib</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.mount" title="Permalink to this definition">¶</a></dt>
<dd><p>Mount FUSE at the given path.</p>
<p>The library must not be a FUSE-mounted virtual library.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>lib</strong> (<em>BaseLibrary</em>) &#8211;
Library instance.</li>
<li><strong>*args</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.mknode">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">mknode</tt><big>(</big><em>sock</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.mknode" title="Permalink to this definition">¶</a></dt>
<dd><p>Make a node in FUSE.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>sock</strong> (<em>socket</em>) &#8211;
sock (socket): A socket object for a library&#8217;s FUSE socket.</li>
<li><strong>args*</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.commands.rmnode">
<tt class="descclassname">dantalian.commands.</tt><tt class="descname">rmnode</tt><big>(</big><em>sock</em>, <em>*args</em><big>)</big><a class="headerlink" href="#dantalian.commands.rmnode" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove a node in FUSE.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>sock</strong> (<em>socket</em>) &#8211;
sock (socket): A socket object for a library&#8217;s FUSE socket.</li>
<li><strong>args*</strong> &#8211;
Arguments passed on to ArgumentParser (See code).</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
<div class="section" id="module-dantalian.errors">
<span id="errors-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">errors</span></tt> Module<a class="headerlink" href="#module-dantalian.errors" title="Permalink to this headline">¶</a></h2>
<dl class="exception">
<dt id="dantalian.errors.DependencyError">
<em class="property">exception </em><tt class="descclassname">dantalian.errors.</tt><tt class="descname">DependencyError</tt><a class="headerlink" href="#dantalian.errors.DependencyError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.Exception</span></tt></p>
<p>Dependency error</p>
</dd></dl>

</div>
<div class="section" id="module-dantalian.library">
<span id="library-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">library</span></tt> Module<a class="headerlink" href="#module-dantalian.library" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="dantalian.library.init_library">
<tt class="descclassname">dantalian.library.</tt><tt class="descname">init_library</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.init_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Initialize a library at <cite>root</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><strong>root</strong> (<em>str</em>) &#8211;
A path.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A Library instance for the initialized library.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.library.open_library">
<tt class="descclassname">dantalian.library.</tt><tt class="descname">open_library</tt><big>(</big><em>root=None</em><big>)</big><a class="headerlink" href="#dantalian.library.open_library" title="Permalink to this definition">¶</a></dt>
<dd><p>Open a library.</p>
<p>If <cite>root</cite> is <tt class="xref py py-const docutils literal"><span class="pre">None</span></tt>, search up the directory tree for the
first library (a directory that contains <tt class="docutils literal"><span class="pre">.dantalian</span></tt>) we find and
use that.  If none are found, raises <a class="reference internal" href="#dantalian.library.LibraryError" title="dantalian.library.LibraryError"><tt class="xref py py-exc docutils literal"><span class="pre">LibraryError</span></tt></a>.
Otherwise, <cite>root</cite> will be used.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><strong>root</strong> (<em>str or None</em>) &#8211;
A path.  Default is None.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body">A Library instance or suitable subclass.</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="dantalian.library.BaseLibrary">
<em class="property">class </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">BaseLibrary</tt><a class="headerlink" href="#dantalian.library.BaseLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>BaseLibrary is the fundamental abstract library class.  It requires
the following methods and invariants:</p>
<dl class="docutils">
<dt>tag(file, tag)</dt>
<dd><cite>file</cite> should be tagged with <cite>tag</cite> after call, regardless of
whether it was before.</dd>
<dt>untag(file, tag)</dt>
<dd><cite>file</cite> should not be tagged with <cite>tag</cite> after call, regardless of
whether it was before.</dd>
<dt>listtags(file)</dt>
<dd>Return a list of all of the tags of <cite>file</cite>.</dd>
<dt>find(tags)</dt>
<dd>Return a list of files that have all of the given tags in
<cite>tags</cite>.</dd>
<dt>mount(path, tree)</dt>
<dd>Mount a virtual representation of the library representation
<cite>tree</cite> at <cite>path</cite>.  This may be left unimplemented or with a
dummy implementation.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="dantalian.library.BaseFSLibrary">
<em class="property">class </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">BaseFSLibrary</tt><a class="headerlink" href="#dantalian.library.BaseFSLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.library.BaseLibrary" title="dantalian.library.BaseLibrary"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.library.BaseLibrary</span></tt></a></p>
<p>BaseFSLibrary is the abstract class for libraries implemented on a
file system.  It requires the following methods and invariants in
addition to those described in BaseLibrary:</p>
<dl class="docutils">
<dt>tag(file, tag)</dt>
<dd>If <cite>file</cite> does not have a hard link under the <cite>tag</cite> directory,
make one.  <cite>file</cite> has at least one hard link under the <cite>tag</cite>
directory after call.</dd>
<dt>untag(file, tag)</dt>
<dd><cite>file</cite> has no hard links under the <cite>tag</cite> directory after call,
regardless of whether it did before.</dd>
</dl>
</dd></dl>

<dl class="class">
<dt id="dantalian.library.Library">
<em class="property">class </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">Library</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.library.BaseFSLibrary" title="dantalian.library.BaseFSLibrary"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.library.BaseFSLibrary</span></tt></a></p>
<p>Libraries should not be instantiated directly; use
<a class="reference internal" href="#dantalian.library.open_library" title="dantalian.library.open_library"><tt class="xref py py-func docutils literal"><span class="pre">open_library()</span></tt></a> instead.</p>
<p>The Library class has the following static and class methods which
return path strings to dantalian libraries&#8217; special directories.
All of them are LRU cached.</p>
<dl class="staticmethod">
<dt id="dantalian.library.Library.rootdir">
<em class="property">static </em><tt class="descname">rootdir</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.rootdir" title="Permalink to this definition">¶</a></dt>
<dd><p>The main dantalian special directory: <tt class="docutils literal"><span class="pre">.dantalian</span></tt>.</p>
</dd></dl>

<dl class="staticmethod">
<dt id="dantalian.library.Library.fuserootdir">
<em class="property">static </em><tt class="descname">fuserootdir</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.fuserootdir" title="Permalink to this definition">¶</a></dt>
<dd><p>The main dantalian special directory, mirrored for FUSE-mounted
libraries: <tt class="docutils literal"><span class="pre">.dantalian-fuse</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="dantalian.library.Library.rootfile">
<em class="property">classmethod </em><tt class="descname">rootfile</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.rootfile" title="Permalink to this definition">¶</a></dt>
<dd><p>A file which tracks the absolute path to the library root:
<tt class="docutils literal"><span class="pre">.dantalian/root</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="dantalian.library.Library.dirsdir">
<em class="property">classmethod </em><tt class="descname">dirsdir</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.dirsdir" title="Permalink to this definition">¶</a></dt>
<dd><p>A directory containing all converted directories:
<tt class="docutils literal"><span class="pre">.dantalian/dirs</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="dantalian.library.Library.treefile">
<em class="property">classmethod </em><tt class="descname">treefile</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.treefile" title="Permalink to this definition">¶</a></dt>
<dd><p>The file with the FUSE mount tree information:
<tt class="docutils literal"><span class="pre">.dantalian/mount</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="dantalian.library.Library.ctreefile">
<em class="property">classmethod </em><tt class="descname">ctreefile</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.ctreefile" title="Permalink to this definition">¶</a></dt>
<dd><p>The file with the custom FUSE mount tree builder:
<tt class="docutils literal"><span class="pre">.dantalian/mount_custom</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="dantalian.library.Library.fusesock">
<em class="property">classmethod </em><tt class="descname">fusesock</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.fusesock" title="Permalink to this definition">¶</a></dt>
<dd><p>The socket for a FUSE mounted library:
<tt class="docutils literal"><span class="pre">.dantalian/fuse.sock</span></tt>.</p>
</dd></dl>

<p>Library instances have the following public methods:</p>
<dl class="method">
<dt id="dantalian.library.Library.tag">
<tt class="descname">tag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Tag file with tag.</p>
<p>If <cite>file</cite> is already tagged, nothing happens.  This includes if
the file is hardlinked under another name.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first simple">
<li><strong>file</strong> (<em>str</em>) &#8211;
Path to the file, relative to the working
directory.</li>
<li><strong>tag</strong> (<em>str</em>) &#8211;
Tag, relative to the library root, starting with
&#8216;/&#8217;.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><p class="first last"><tt class="xref py py-exc docutils literal"><span class="pre">IsADirectoryError</span></tt> &#8211; 
file is an unconverted directory.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.untag">
<tt class="descname">untag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.untag" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove tag from file.</p>
<p>If file is not tagged, nothing happens.  Remove <em>all</em> hard
links to the file in the directory corresponding to the given
tag.  Log a warning when an OSError is caught.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>file</strong> (<em>str</em>) &#8211;
Path to the file, relative to the working
directory.</li>
<li><strong>tag</strong> (<em>str</em>) &#8211;
Tag, relative to the library root, starting with
&#8216;/&#8217;.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.listtags">
<tt class="descname">listtags</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.listtags" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of all tags of <cite>file</cite></p>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.convert">
<tt class="descname">convert</tt><big>(</big><em>dir</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a directory to a symlink.</p>
<p>If <cite>dir</cite> is in <tt class="docutils literal"><span class="pre">.dantalian/dirs</span></tt> (smartassery), convert raises
LibraryError.  If <cite>dir</cite> is a symlink (probably already
converted), convert returns without doing anything.  If <cite>dir</cite> is
not a directory, NotADirectoryError will be raised.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><p class="first"><strong>dir</strong> (<em>str</em>) &#8211;
Path to directory.</p>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Raises :</th><td class="field-body"><ul class="first last simple">
<li><tt class="xref py py-exc docutils literal"><span class="pre">NotADirectoryError</span></tt> &#8211; 
dir is not a directory.</li>
<li><a class="reference internal" href="#dantalian.library.LibraryError" title="dantalian.library.LibraryError"><tt class="xref py py-exc docutils literal"><span class="pre">LibraryError</span></tt></a> &#8211; 
dir is in the directory for converted
directories.</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.cleandirs">
<tt class="descname">cleandirs</tt><big>(</big><big>)</big><a class="headerlink" href="#dantalian.library.Library.cleandirs" title="Permalink to this definition">¶</a></dt>
<dd><p>Clean converted directories.</p>
<p>Remove directories in the library&#8217;s converted directories
directory which do not have a symlink in the library that
references them.  Nuke them with shutil.rmtree.</p>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.find">
<tt class="descname">find</tt><big>(</big><em>tags</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.find" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of files with all of the given tags.</p>
<p><cite>tags</cite> is a list. <cite>tags</cite> is left unchanged.  Returns a list.
File paths are absolute and are paths to the hard link under the
first tag given.</p>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.rm">
<tt class="descname">rm</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.rm" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes all tags from <cite>file</cite>.</p>
<p><cite>file</cite> is a path relative to the current dir.  If <cite>file</cite> is not
tagged, nothing happens.  If a file cannot be removed (for
whatever reason), it is skipped, a warning is logged, and
rm() returns <tt class="docutils literal"><span class="pre">1</span></tt>.  Otherwise, returns <tt class="docutils literal"><span class="pre">0</span></tt>.</p>
<p>This removes all hard links in the library to <cite>file</cite>!  If no
other hard links exist, <cite>file</cite> is deleted.</p>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.rename">
<tt class="descname">rename</tt><big>(</big><em>file</em>, <em>new</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename tracked file.</p>
<p>Rename all hard links in the library of <cite>file</cite> to <cite>new</cite>.  If
<cite>file</cite> is not tagged, nothing happens.  If a file cannot be
renamed, log an error and continue.</p>
</dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.fix">
<tt class="descname">fix</tt><big>(</big><big>)</big><a class="headerlink" href="#dantalian.library.Library.fix" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="method">
<dt id="dantalian.library.Library.mount">
<tt class="descname">mount</tt><big>(</big><em>path</em>, <em>tree</em><big>)</big><a class="headerlink" href="#dantalian.library.Library.mount" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="class">
<dt id="dantalian.library.ProxyLibrary">
<em class="property">class </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">ProxyLibrary</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.library.ProxyLibrary" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.library.Library" title="dantalian.library.Library"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.library.Library</span></tt></a></p>
<p>Subclass of Library which overrides a number of methods for a
FUSE-mounted library.</p>
</dd></dl>

<dl class="class">
<dt id="dantalian.library.SocketOperations">
<em class="property">class </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">SocketOperations</tt><big>(</big><em>sock</em>, <em>root</em>, <em>tree</em><big>)</big><a class="headerlink" href="#dantalian.library.SocketOperations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">threading.Thread</span></tt></p>
<p>A Thread that manages a FUSE-mounted library and its socket, reading
from the socket and processing commands.</p>
<p>Methods that begin with <tt class="docutils literal"><span class="pre">do_</span></tt> are commands.  The following input
to the socket:</p>
<div class="highlight-python"><pre>command arg1 arg2 arg3</pre>
</div>
<p>will result in the method call:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">do_command</span><span class="p">(</span><span class="n">arg1</span><span class="p">,</span> <span class="n">arg2</span><span class="p">,</span> <span class="n">arg3</span><span class="p">)</span>
</pre></div>
</div>
<dl class="function">
<dt id="dantalian.library.SocketOperations.do_mknode">
<tt class="descname">do_mknode</tt><big>(</big><em>self</em>, <em>path</em>, <em>*tags</em><big>)</big><a class="headerlink" href="#dantalian.library.SocketOperations.do_mknode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.library.SocketOperations.do_rmnode">
<tt class="descname">do_rmnode</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.library.SocketOperations.do_rmnode" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.library.SocketOperations.run">
<tt class="descname">run</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.library.SocketOperations.run" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.library.SocketOperations.stop">
<tt class="descname">stop</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.library.SocketOperations.stop" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="exception">
<dt id="dantalian.library.LibraryError">
<em class="property">exception </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">LibraryError</tt><a class="headerlink" href="#dantalian.library.LibraryError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.Exception</span></tt></p>
</dd></dl>

<dl class="exception">
<dt id="dantalian.library.TagError">
<em class="property">exception </em><tt class="descclassname">dantalian.library.</tt><tt class="descname">TagError</tt><a class="headerlink" href="#dantalian.library.TagError" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.library.LibraryError" title="dantalian.library.LibraryError"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.library.LibraryError</span></tt></a></p>
</dd></dl>

</div>
<div class="section" id="module-dantalian.operations">
<span id="operations-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">operations</span></tt> Module<a class="headerlink" href="#module-dantalian.operations" title="Permalink to this headline">¶</a></h2>
<p>This module defines the FUSE operations dantalian uses.  Thus, how FUSE
behaves is defined here.</p>
<p>For brevity, there are a few terms for referring to paths in virtual
FUSE space.  &#8220;Node&#8221; means the path points to a Node, i.e. fully in
virtual space.  &#8220;Tagged&#8221; means the path points to a file directly
under a TagNode in real file system space.  Special tagging or untagging
operations are perfomed on these.  &#8220;Outside&#8221; means the path points fully
outside virtual space, i.e. more than one directory beyond a TagNode or
any files beyond the RootNode.</p>
<dl class="class">
<dt id="dantalian.operations.TagOperations">
<em class="property">class </em><tt class="descclassname">dantalian.operations.</tt><tt class="descname">TagOperations</tt><big>(</big><em>root</em>, <em>tree</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">dantalian.fuse.LoggingMixIn</span></tt>, <tt class="xref py py-class docutils literal"><span class="pre">dantalian.fuse.Operations</span></tt></p>
<dl class="function">
<dt id="dantalian.operations.TagOperations.chmod">
<tt class="descname">chmod</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.chmod" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.chown">
<tt class="descname">chown</tt><big>(</big><em>self</em>, <em>path</em>, <em>uid</em>, <em>gid</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.chown" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.create">
<tt class="descname">create</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.create" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is
tagged, additionally add its tags.  If <cite>path</cite> is a node, the
operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.getattr">
<tt class="descname">getattr</tt><big>(</big><em>self</em>, <em>path</em>, <em>fh=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.getattr" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, get attributes from node.</p>
</dd></dl>

<dl class="attribute">
<dt id="dantalian.operations.TagOperations.getxattr">
<tt class="descname">getxattr</tt><em class="property"> = None</em><a class="headerlink" href="#dantalian.operations.TagOperations.getxattr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.link">
<tt class="descname">link</tt><big>(</big><em>self</em>, <em>source</em>, <em>target</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.link" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this is different from standard.  Usually link(a, b)
creates a link at a to b, but this link(source, target) creates
a link at source to target.</p>
<p>If <cite>source</cite> is tagged, tag it.  If <cite>source</cite> is outside, link it.
If <cite>source</cite> is a node, raise EINVAL</p>
</dd></dl>

<dl class="attribute">
<dt id="dantalian.operations.TagOperations.listxattr">
<tt class="descname">listxattr</tt><em class="property"> = None</em><a class="headerlink" href="#dantalian.operations.TagOperations.listxattr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.mkdir">
<tt class="descname">mkdir</tt><big>(</big><em>self</em>, <em>path</em>, <em>mode</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.mkdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If it is tagged,
additionally convert it and add tags.  If <cite>path</cite> is a node, the
operation is invalid and raises EINVAL.</p>
<p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
<p>If <cite>path</cite> points beyond a node, forward the request to the OS
(via built-in os module).  Once a directory is created, it is
converted and tagged with all of the tags of the furthest node.
Otherwise the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.open">
<tt class="descname">open</tt><big>(</big><em>self</em>, <em>path</em>, <em>flags</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.open" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.read">
<tt class="descname">read</tt><big>(</big><em>self</em>, <em>path</em>, <em>size</em>, <em>offset</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.read" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>path</cite> is ignored.  Forward the request to the OS (via built-in
os module) with the file descriptor.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.readdir">
<tt class="descname">readdir</tt><big>(</big><em>self</em>, <em>path</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.readdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, a directory listing containing &#8216;.&#8217; and &#8216;..&#8217; is made and
generated entries from the node&#8217;s __iter__ are added.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.readlink">
<tt class="descname">readlink</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.readlink" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="attribute">
<dt id="dantalian.operations.TagOperations.removexattr">
<tt class="descname">removexattr</tt><em class="property"> = None</em><a class="headerlink" href="#dantalian.operations.TagOperations.removexattr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.rename">
<tt class="descname">rename</tt><big>(</big><em>self</em>, <em>old</em>, <em>new</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.rename" title="Permalink to this definition">¶</a></dt>
<dd><p>This one is tricky; here&#8217;s a handy chart.</p>
<table border="1" class="docutils">
<colgroup>
<col width="16%" />
<col width="16%" />
<col width="34%" />
<col width="34%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Old</th>
<th class="head">To Node</th>
<th class="head">To Tagged</th>
<th class="head">To Outside</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>Node</td>
<td>EINVAL</td>
<td>EINVAL</td>
<td>EINVAL</td>
</tr>
<tr class="row-odd"><td>Tagged</td>
<td>EINVAL</td>
<td>untag, tag</td>
<td>move, untag</td>
</tr>
<tr class="row-even"><td>Outside</td>
<td>EINVAL</td>
<td>tag, remove</td>
<td>move</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.rmdir">
<tt class="descname">rmdir</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.rmdir" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  (If it&#8217;s tagged,
it&#8217;s not a dir, but we&#8217;ll let the OS handle that =))  If <cite>path</cite>
is a node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="attribute">
<dt id="dantalian.operations.TagOperations.setxattr">
<tt class="descname">setxattr</tt><em class="property"> = None</em><a class="headerlink" href="#dantalian.operations.TagOperations.setxattr" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.statfs">
<tt class="descname">statfs</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.statfs" title="Permalink to this definition">¶</a></dt>
<dd><p>Forward the request to the OS (via built-in os module).</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.symlink">
<tt class="descname">symlink</tt><big>(</big><em>self</em>, <em>source</em>, <em>target</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.symlink" title="Permalink to this definition">¶</a></dt>
<dd><p>Note that this is different from standard.  Usually link(a, b)
creates a link at a to b, but this link(source, target) creates
a link at source to target.</p>
<p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.truncate">
<tt class="descname">truncate</tt><big>(</big><em>self</em>, <em>path</em>, <em>length</em>, <em>fh=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.truncate" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If it is tagged,
additionally add its tags.  If <cite>path</cite> is a node, the operation
is invalid and raises EINVAL. <cite>fh</cite> is ignored.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.unlink">
<tt class="descname">unlink</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.unlink" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is tagged, untag.  If <cite>path</cite> is outside, forward to
OS.  If <cite>path</cite> is a node, the operation is invalid and raises
EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.utimens">
<tt class="descname">utimens</tt><big>(</big><em>self</em>, <em>path</em>, <em>times=None</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.utimens" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.operations.TagOperations.write">
<tt class="descname">write</tt><big>(</big><em>self</em>, <em>path</em>, <em>data</em>, <em>offset</em>, <em>fh</em><big>)</big><a class="headerlink" href="#dantalian.operations.TagOperations.write" title="Permalink to this definition">¶</a></dt>
<dd><p>If <cite>path</cite> is outside or tagged, forward to OS.  If <cite>path</cite> is a
node, the operation is invalid and raises EINVAL.  <cite>fh</cite> is used;
<cite>path</cite> is only used for verification.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="dantalian.operations.mount">
<tt class="descclassname">dantalian.operations.</tt><tt class="descname">mount</tt><big>(</big><em>path</em>, <em>root</em>, <em>tree</em><big>)</big><a class="headerlink" href="#dantalian.operations.mount" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</div>
<div class="section" id="module-dantalian.path">
<span id="path-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">path</span></tt> Module<a class="headerlink" href="#module-dantalian.path" title="Permalink to this headline">¶</a></h2>
<dl class="function">
<dt id="dantalian.path.pathfromtag">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">pathfromtag</tt><big>(</big><em>tag</em>, <em>root</em><big>)</big><a class="headerlink" href="#dantalian.path.pathfromtag" title="Permalink to this definition">¶</a></dt>
<dd><p>Get path from tag</p>
<p><cite>tag</cite> is absolute from the library root.
<cite>root</cite> is the library root directory.</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.path.tagfrompath">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">tagfrompath</tt><big>(</big><em>path</em>, <em>root</em><big>)</big><a class="headerlink" href="#dantalian.path.tagfrompath" title="Permalink to this definition">¶</a></dt>
<dd><p>Return absolute tag from path</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.path.listdir">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">listdir</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#dantalian.path.listdir" title="Permalink to this definition">¶</a></dt>
<dd><p>Return full paths of files in <cite>path</cite>.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body"><cite>iterator</cite></td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.path.resolve_name">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">resolve_name</tt><big>(</big><em>dir</em>, <em>name</em><big>)</big><a class="headerlink" href="#dantalian.path.resolve_name" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.path.fuse_resolve">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">fuse_resolve</tt><big>(</big><em>name</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.path.fuse_resolve" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.path.fuse_resolve_path">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">fuse_resolve_path</tt><big>(</big><em>path</em><big>)</big><a class="headerlink" href="#dantalian.path.fuse_resolve_path" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.path.fixsymlinks">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">fixsymlinks</tt><big>(</big><em>links</em>, <em>oldprefix</em>, <em>newprefix</em><big>)</big><a class="headerlink" href="#dantalian.path.fixsymlinks" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix symlinks</p>
<p>Recursively replace symlinks <cite>links</cite> that match <cite>oldprefix</cite> with
<cite>newprefix</cite>.  <cite>links</cite> is as returned from findsymlinks().</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.path.findsymlinks">
<tt class="descclassname">dantalian.path.</tt><tt class="descname">findsymlinks</tt><big>(</big><em>dir</em><big>)</big><a class="headerlink" href="#dantalian.path.findsymlinks" title="Permalink to this definition">¶</a></dt>
<dd><p>Find symlinks</p>
<p>Returns a list of lists.  Symlinks that are the same inode are
grouped together.  Relies on &#8216;find&#8217; utility, for sheer simplicity
and speed.  If it cannot be found, DependencyError is raised.
Output paths are absolute.</p>
</dd></dl>

</div>
<div class="section" id="module-dantalian.tree">
<span id="tree-module"></span><h2><tt class="xref py py-mod docutils literal"><span class="pre">tree</span></tt> Module<a class="headerlink" href="#module-dantalian.tree" title="Permalink to this headline">¶</a></h2>
<p>This module contains stuff used for managing FUSE virtual space.  The
protocol for nodes is as follows.</p>
<p>FSNodes are purely virtual.  Their children are other nodes.</p>
<p>BorderNodes bridge into real file system space.  They may have also have
strings as children, which are absolute paths into real file system
space.</p>
<p>Nodes implement the methods for a mapping data model (i.e., __getitem__,
__setitem__, __delitem__).</p>
<p>The keys are strings with file names (like in file systems/directory
tables).</p>
<p>The values are strings with the paths to files and directories on the
actual file system, and node objects for nodes.</p>
<dl class="class">
<dt id="dantalian.tree.BaseNode">
<em class="property">class </em><tt class="descclassname">dantalian.tree.</tt><tt class="descname">BaseNode</tt><a class="headerlink" href="#dantalian.tree.BaseNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <tt class="xref py py-class docutils literal"><span class="pre">builtins.object</span></tt></p>
<p>Base interface for all Nodes.  <tt class="docutils literal"><span class="pre">__iter__</span></tt> provides a listing of
the node&#8217;s contents.  <tt class="docutils literal"><span class="pre">__getitem__</span></tt>, <tt class="docutils literal"><span class="pre">__setitem__</span></tt>, and
<tt class="docutils literal"><span class="pre">__delitem__</span></tt> describe a mapping data model interface.  <tt class="docutils literal"><span class="pre">dump</span></tt>
implements dumping JSON-compatible objects.</p>
<dl class="function">
<dt id="dantalian.tree.BaseNode.dump">
<tt class="descname">dump</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.tree.BaseNode.dump" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

<dl class="function">
<dt id="dantalian.tree.BaseNode.get">
<tt class="descname">get</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.tree.BaseNode.get" title="Permalink to this definition">¶</a></dt>
<dd><p>Get node and path components</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><strong>path</strong> (<em>list</em>) &#8211;
List of strings that form a path.  This list will be
modified, so make a copy if you need the original list.</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><strong>(cur, path, ret)</strong> (<em>tuple</em>) &#8211;
<cite>cur</cite> is the furthest node along the path, and <cite>path</cite> is a
list of strings indicating the path from the given node (the
same list object that was passed in).  If node is the last
file in the path, path is an empty list.<p><cite>ret</cite> is the return code.  0 means successful, 1 means path
is broken, in which case <cite>cur</cite> goes up to the furthest node
where the path broke and <cite>path</cite> contains the remaining path
components.</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="dantalian.tree.BaseNode.getfrompath">
<tt class="descname">getfrompath</tt><big>(</big><em>self</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.tree.BaseNode.getfrompath" title="Permalink to this definition">¶</a></dt>
<dd></dd></dl>

</dd></dl>

<dl class="function">
<dt id="dantalian.tree.load">
<tt class="descclassname">dantalian.tree.</tt><tt class="descname">load</tt><big>(</big><em>root</em>, <em>nodes</em><big>)</big><a class="headerlink" href="#dantalian.tree.load" title="Permalink to this definition">¶</a></dt>
<dd><table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first last simple">
<li><strong>root</strong> (<em>Library</em>) &#8211;
Library instance to use for RootNode</li>
<li><strong>nodes</strong> (<em>list</em>) &#8211;
JSON dump of node tree</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="dantalian.tree.FSNode">
<em class="property">class </em><tt class="descclassname">dantalian.tree.</tt><tt class="descname">FSNode</tt><a class="headerlink" href="#dantalian.tree.FSNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.tree.BaseNode" title="dantalian.tree.BaseNode"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BaseNode</span></tt></a></p>
<p>Mock directory.  FSNode works like a dictionary mapping names to
nodes and keeps some internal file attributes.</p>
<p>Implements:</p>
<ul class="simple">
<li>__iter__</li>
<li>__getitem__</li>
<li>__setitem__</li>
<li>__delitem__</li>
</ul>
<p>File Attributes:</p>
<dl class="docutils">
<dt>atime, ctime, mtime</dt>
<dd>Defaults to current time</dd>
<dt>uid, gid</dt>
<dd>Defaults to process&#8217;s uid, gid</dd>
<dt>mode</dt>
<dd>Set directory bit, and permission bits 0o777 minus umask</dd>
<dt>nlinks</dt>
<dd>Only keeps track of nodes, not TagNode directories</dd>
<dt>size</dt>
<dd>constant 4096</dd>
</dl>
<dl class="function">
<dt id="dantalian.tree.FSNode.dump">
<tt class="descname">dump</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.tree.FSNode.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump object.</p>
<p>Dumps the node in the following format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;FSNode&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">child</span><span class="p">}]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dantalian.tree.BorderNode">
<em class="property">class </em><tt class="descclassname">dantalian.tree.</tt><tt class="descname">BorderNode</tt><a class="headerlink" href="#dantalian.tree.BorderNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.tree.FSNode" title="dantalian.tree.FSNode"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.FSNode</span></tt></a></p>
<p>BorderNode is an abstract class for subclasses of FSNode which reach
outsie of the virtual space</p>
</dd></dl>

<dl class="class">
<dt id="dantalian.tree.TagNode">
<em class="property">class </em><tt class="descclassname">dantalian.tree.</tt><tt class="descname">TagNode</tt><big>(</big><em>root</em>, <em>tags</em><big>)</big><a class="headerlink" href="#dantalian.tree.TagNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.tree.BorderNode" title="dantalian.tree.BorderNode"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BorderNode</span></tt></a></p>
<p>TagNode adds a method, tagged(), which returns a generated dict
mapping names to files that satisfy the TagNode&#8217;s tags criteria, and
adds these to __iter__ and __getitem__</p>
<dl class="function">
<dt id="dantalian.tree.TagNode.dump">
<tt class="descname">dump</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.tree.TagNode.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump object.</p>
<p>Dumps the node in the following format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;TagNode&#39;</span><span class="p">,</span> <span class="p">[</span><span class="n">tag</span><span class="p">],</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">child</span><span class="p">}]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="dantalian.tree.RootNode">
<em class="property">class </em><tt class="descclassname">dantalian.tree.</tt><tt class="descname">RootNode</tt><big>(</big><em>root</em><big>)</big><a class="headerlink" href="#dantalian.tree.RootNode" title="Permalink to this definition">¶</a></dt>
<dd><p>Bases: <a class="reference internal" href="#dantalian.tree.BorderNode" title="dantalian.tree.BorderNode"><tt class="xref py py-class docutils literal"><span class="pre">dantalian.tree.BorderNode</span></tt></a></p>
<p>A special Node that doesn&#8217;t actually look for tags, merely
projecting the library root into virtual space.</p>
<dl class="function">
<dt id="dantalian.tree.RootNode.dump">
<tt class="descname">dump</tt><big>(</big><em>self</em><big>)</big><a class="headerlink" href="#dantalian.tree.RootNode.dump" title="Permalink to this definition">¶</a></dt>
<dd><p>Dump object.</p>
<p>Dumps the node in the following format:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="p">[</span><span class="s">&#39;RootNode&#39;</span><span class="p">,</span> <span class="p">{</span><span class="n">name</span><span class="p">:</span> <span class="n">child</span><span class="p">}]</span>
</pre></div>
</div>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="dantalian.tree.fs2tag">
<tt class="descclassname">dantalian.tree.</tt><tt class="descname">fs2tag</tt><big>(</big><em>node</em>, <em>root</em>, <em>tags</em><big>)</big><a class="headerlink" href="#dantalian.tree.fs2tag" title="Permalink to this definition">¶</a></dt>
<dd><p>Convert a FSNode instance to a TagNode instance</p>
</dd></dl>

<dl class="function">
<dt id="dantalian.tree.split">
<tt class="descclassname">dantalian.tree.</tt><tt class="descname">split</tt><big>(</big><em>tree</em>, <em>path</em><big>)</big><a class="headerlink" href="#dantalian.tree.split" title="Permalink to this definition">¶</a></dt>
<dd><p>Get node and path components</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters :</th><td class="field-body"><ul class="first simple">
<li><strong>tree</strong> (<em>RootNode</em>) &#8211;
Root node.</li>
<li><strong>path</strong> (<em>str</em>) &#8211;
Path.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Returns:</th><td class="field-body"><p class="first last"><p>(cur, path), where <cite>cur</cite> is the furthest node along the path,
and <cite>path</cite> is a list of strings indicating the path from the
given node.  If node is the last file in the path, path is an
empty list.</p>
<p>If path is broken, returns None instead.</p>
</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">dantalian Package</a><ul>
<li><a class="reference internal" href="#module-dantalian.commands"><tt class="docutils literal"><span class="pre">commands</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-dantalian.errors"><tt class="docutils literal"><span class="pre">errors</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-dantalian.library"><tt class="docutils literal"><span class="pre">library</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-dantalian.operations"><tt class="docutils literal"><span class="pre">operations</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-dantalian.path"><tt class="docutils literal"><span class="pre">path</span></tt> Module</a></li>
<li><a class="reference internal" href="#module-dantalian.tree"><tt class="docutils literal"><span class="pre">tree</span></tt> Module</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="../api.html"
                        title="previous chapter">API Reference</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../../changes.html"
                        title="next chapter">Changelog</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../../_sources/dev/api/dantalian.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="right" >
          <a href="../../changes.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="../api.html" title="API Reference"
             >previous</a> |</li>
        <li><a href="../../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../../dev.html" >Developer Guide</a> &raquo;</li>
          <li><a href="../api.html" >API Reference</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>