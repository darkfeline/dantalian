

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Library Implementation &mdash; dantalian 0.5-dev documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.5-dev',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.5-dev documentation" href="../index.html" />
    <link rel="up" title="Developer Guide" href="../dev.html" />
    <link rel="next" title="FUSE/Mounted Library Specification" href="fuse.html" />
    <link rel="prev" title="Library Specification" href="library.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="fuse.html" title="FUSE/Mounted Library Specification"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="library.html" title="Library Specification"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../dev.html" accesskey="U">Developer Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="library-implementation">
<h1>Library Implementation<a class="headerlink" href="#library-implementation" title="Permalink to this headline">¶</a></h1>
<p>This section documents dantalian&#8217;s library implementation.  See
<a class="reference internal" href="library.html#library-spec"><em>Library Specification</em></a> for a reference to the library specification.</p>
<div class="section" id="library">
<h2>Library<a class="headerlink" href="#library" title="Permalink to this headline">¶</a></h2>
<p>Library is the actual implementation that dantalian provides.  It
implements the following public methods and invariants in addition to
those described in BaseFSLibrary (Filename/path conflicts will be
resolved according to <a class="reference internal" href="../user/reference/names.html#rename-alg"><em>File Renaming Algorithm</em></a>.):</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">dantalian respects symbolic links to directories outside of the
library (Internal symbolic links should always be converted by
dantalian.  Handmade symbolic links to library-internal paths subject
to breakage and Armageddon.).  For simple operations, dantalian will
act as though these directories are a part of the library.  For
complex operations, these external directories will be ignored (This
is because dantalian is not really descending symbolic links, but
only acting on the directories stored internally. This simulates only
descending into internal symbolic links.).  The latter case will be
noted below if applicable.</p>
</div>
<dl class="method">
<dt>
<tt class="descname">tag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p>If <cite>file</cite> does not have a hard link under the <cite>tag</cite> directory, make
one.  <cite>file</cite> has at least one hard link under the <cite>tag</cite> directory
after call.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">untag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p><cite>file</cite> should not be tagged with <cite>tag</cite> after call, regardless of
whether it was before.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">listtags</tt><big>(</big><em>file</em><big>)</big></dt>
<dd><p>Return a list of all of the tags of <cite>file</cite>.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">find</tt><big>(</big><em>tags</em><big>)</big></dt>
<dd><p>Return a list of files that have all of the given tags in <cite>tags</cite>.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">mount</tt><big>(</big><em>path</em>, <em>tree</em><big>)</big></dt>
<dd><p>Mount a virtual representation of the library representation <cite>tree</cite>
at <cite>path</cite>.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">convert</tt><big>(</big><em>dir</em><big>)</big></dt>
<dd><p>Store directory <cite>dir</cite> internally and replace the original with a
symbolic link with the same name pointing to the absolute path of the
stored directory.  Resolve name conflict if necessary (if a file with
the same name is made in between moving the directory and creating
the symbolic link, for example).</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">cleandirs</tt><big>(</big><big>)</big></dt>
<dd><p>Remove all directories stored internally that no longer have any
symbolic links referring to them in the library.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">rm</tt><big>(</big><em>file</em><big>)</big></dt>
<dd><p>Remove all hard links to <cite>file</cite> in the library.  Any errors will be
reported and removal will resume for remaining hard links.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="xref py py-meth docutils literal"><span class="pre">rm()</span></tt> does not descend into symbolic links to external
directories.</p>
</div>
<dl class="method">
<dt>
<tt class="descname">rename</tt><big>(</big><em>file</em>, <em>new</em><big>)</big></dt>
<dd><p>Rename all hard links to <cite>file</cite> in the library to <cite>new</cite>.  File name
conflicts are resolved and reported.  Any errors
will be reported and renaming will resume for remaining hard links.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><tt class="xref py py-meth docutils literal"><span class="pre">rename()</span></tt> does not descend into symbolic links to external
directories.</p>
</div>
<dl class="method">
<dt>
<tt class="descname">fix</tt><big>(</big><big>)</big></dt>
<dd><p>Fix the absolute paths of symbolic links in the library to internally
stored directories.  Hard link relationships of the symbolic links
are preserved <em>only in the library</em>.  (This is because the Linux
kernel/POSIX system calls do not allow for editing symbolic links in
place.  They must be unlinked and remade.)  Symbolic links are
unlinked and a new symbolic link is made then relinked.  Filename
conflicts are resolved and reported (if a file with the same name is
made in between deleting and creating the symbolic link, for
example).</p>
</dd></dl>

<dl class="method">
<dt id="maketree">
<tt class="descname">maketree</tt><big>(</big><big>)</big><a class="headerlink" href="#maketree" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tree generated using the library&#8217;s configuration files.</p>
</dd></dl>

</div>
<div class="section" id="proxylibrary">
<h2>ProxyLibrary<a class="headerlink" href="#proxylibrary" title="Permalink to this headline">¶</a></h2>
<p>ProxyLibrary is a subclass of Library for virtual FUSE mounted
libraries.  It overrides the following methods:</p>
<dl class="method">
<dt>
<tt class="descname">fix</tt><big>(</big><big>)</big></dt>
<dd><p>Log a warning and do nothing. (Action not allowed.)</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">mount</tt><big>(</big><em>path</em>, <em>tree</em><big>)</big></dt>
<dd><p>Log a warning and do nothing. (Action not allowed.)</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Library Implementation</a><ul>
<li><a class="reference internal" href="#library">Library</a></li>
<li><a class="reference internal" href="#proxylibrary">ProxyLibrary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="library.html"
                        title="previous chapter">Library Specification</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="fuse.html"
                        title="next chapter">FUSE/Mounted Library Specification</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/dev/libop.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="fuse.html" title="FUSE/Mounted Library Specification"
             >next</a> |</li>
        <li class="right" >
          <a href="library.html" title="Library Specification"
             >previous</a> |</li>
        <li><a href="../index.html">dantalian 0.5-dev documentation</a> &raquo;</li>
          <li><a href="../dev.html" >Developer Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>