

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Library Operations &mdash; dantalian 0.4.1 documentation</title>
    
    <link rel="stylesheet" href="../_static/default.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '0.4.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="top" title="dantalian 0.4.1 documentation" href="../index.html" />
    <link rel="up" title="Developers Guide" href="../dev.html" />
    <link rel="next" title="Changelog" href="../changes.html" />
    <link rel="prev" title="Names and Paths" href="names.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../changes.html" title="Changelog"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="names.html" title="Names and Paths"
             accesskey="P">previous</a> |</li>
        <li><a href="../index.html">dantalian 0.4.1 documentation</a> &raquo;</li>
          <li><a href="../dev.html" accesskey="U">Developers Guide</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="library-operations">
<h1>Library Operations<a class="headerlink" href="#library-operations" title="Permalink to this headline">¶</a></h1>
<p>dantalian describes and implements various tiers of operations described
below.  See <a class="reference internal" href="library.html#library-abstract"><em>The Library Abstraction</em></a> for a reference to the library
abstraction specification.</p>
<div class="section" id="baselibrary">
<h2>BaseLibrary<a class="headerlink" href="#baselibrary" title="Permalink to this headline">¶</a></h2>
<p>BaseLibrary is the fundamental abstract library class.  It requires the
following methods and invariants:</p>
<dl class="method">
<dt id="tag">
<tt class="descname">tag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big><a class="headerlink" href="#tag" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>file</cite> should be tagged with <cite>tag</cite> after call, regardless of whether
it was before.</p>
</dd></dl>

<dl class="method">
<dt id="untag">
<tt class="descname">untag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big><a class="headerlink" href="#untag" title="Permalink to this definition">¶</a></dt>
<dd><p><cite>file</cite> should not be tagged with <cite>tag</cite> after call, regardless of
whether it was before.</p>
</dd></dl>

<dl class="method">
<dt id="listtags">
<tt class="descname">listtags</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#listtags" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of all of the tags of <cite>file</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="find">
<tt class="descname">find</tt><big>(</big><em>tags</em><big>)</big><a class="headerlink" href="#find" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a list of files that have all of the given tags in <cite>tags</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="mount">
<tt class="descname">mount</tt><big>(</big><em>path</em>, <em>tree</em><big>)</big><a class="headerlink" href="#mount" title="Permalink to this definition">¶</a></dt>
<dd><p>Mount a virtual representation of the library representation <cite>tree</cite>
at <cite>path</cite>.  This may be left unimplemented or with a dummy
implementation.</p>
</dd></dl>

<p>BaseLibrary exists to facilitate alternate implementations of dantalian
libraries not based on file systems, e.g., a MySQL backend.</p>
</div>
<div class="section" id="basefslibrary">
<h2>BaseFSLibrary<a class="headerlink" href="#basefslibrary" title="Permalink to this headline">¶</a></h2>
<p>BaseFSLibrary is the abstract class for libraries implemented on a file
system.  It requires the following methods and invariants in addition to
those described in BaseLibrary:</p>
<dl class="method">
<dt>
<tt class="descname">tag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p>If <cite>file</cite> does not have a hard link under the <cite>tag</cite> directory, make
one.  <cite>file</cite> has at least one hard link under the <cite>tag</cite> directory
after call.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">untag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p><cite>file</cite> has no hard links under the <cite>tag</cite> directory after call,
regardless of whether it did before.</p>
</dd></dl>

</div>
<div class="section" id="library">
<h2>Library<a class="headerlink" href="#library" title="Permalink to this headline">¶</a></h2>
<p>Library is the actual implementation that dantalian provides.  It
implements the following public methods and invariants in addition to
those described in BaseFSLibrary (Filename/path conflicts will be
resolved according to <a class="reference internal" href="names.html#rename-alg"><em>File Renaming Algorithm</em></a>.):</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">dantalian respects symbolic links to directories outside of the
library (Internal symbolic links should always be converted by
dantalian.  Handmade symbolic links to library-internal paths subject
to breakage and Armageddon.).  For simple operations, dantalian will
act as though these directories are a part of the library.  For
complex operations, these external directories will be ignored (This
is because dantalian is not really descending symbolic links, but
only acting on the directories stored internally. This simulates only
descending into internal symbolic links.).  The latter case will be
noted below if applicable.</p>
</div>
<dl class="method">
<dt>
<tt class="descname">tag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p>Tag file as in BaseFSLibrary.  Resolve name conflict if necessary.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">untag</tt><big>(</big><em>file</em>, <em>tag</em><big>)</big></dt>
<dd><p>Same as BaseFSLibrary</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">listtags</tt><big>(</big><em>file</em><big>)</big></dt>
<dd><p>Same as BaseFSLibrary</p>
</dd></dl>

<dl class="method">
<dt id="convert">
<tt class="descname">convert</tt><big>(</big><em>dir</em><big>)</big><a class="headerlink" href="#convert" title="Permalink to this definition">¶</a></dt>
<dd><p>Store directory <cite>dir</cite> internally and replace the original with a
symbolic link with the same name pointing to the absolute path of the
stored directory.  Resolve name conflict if necessary (if a file with
the same name is made in between moving the directory and creating
the symbolic link, for example).</p>
</dd></dl>

<dl class="method">
<dt id="cleandirs">
<tt class="descname">cleandirs</tt><big>(</big><big>)</big><a class="headerlink" href="#cleandirs" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all directories stored internally that no longer have any
symbolic links referring to them in the library.</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">find</tt><big>(</big><em>tags</em><big>)</big></dt>
<dd><p>Same as BaseFSLibrary</p>
</dd></dl>

<dl class="method">
<dt id="rm">
<tt class="descname">rm</tt><big>(</big><em>file</em><big>)</big><a class="headerlink" href="#rm" title="Permalink to this definition">¶</a></dt>
<dd><p>Remove all hard links to <cite>file</cite> in the library.  Any errors will be
reported and removal will resume for remaining hard links.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#rm" title="rm"><tt class="xref py py-meth docutils literal"><span class="pre">rm()</span></tt></a> does not descend into symbolic links to external
directories.</p>
</div>
<dl class="method">
<dt id="rename">
<tt class="descname">rename</tt><big>(</big><em>file</em>, <em>new</em><big>)</big><a class="headerlink" href="#rename" title="Permalink to this definition">¶</a></dt>
<dd><p>Rename all hard links to <cite>file</cite> in the library to <cite>new</cite>.  File name
conflicts are resolved and reported.  Any errors
will be reported and renaming will resume for remaining hard links.</p>
</dd></dl>

<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last"><a class="reference internal" href="#rename" title="rename"><tt class="xref py py-meth docutils literal"><span class="pre">rename()</span></tt></a> does not descend into symbolic links to external
directories.</p>
</div>
<dl class="method">
<dt id="fix">
<tt class="descname">fix</tt><big>(</big><big>)</big><a class="headerlink" href="#fix" title="Permalink to this definition">¶</a></dt>
<dd><p>Fix the absolute paths of symbolic links in the library to internally
stored directories.  Hard link relationships of the symbolic links
are preserved <em>only in the library</em>.  (This is because the Linux
kernel/POSIX system calls do not allow for editing symbolic links in
place.  They must be unlinked and remade.)  Symbolic links are
unlinked and a new symbolic link is made then relinked.  Filename
conflicts are resolved and reported (if a file with the same name is
made in between deleting and creating the symbolic link, for
example).</p>
</dd></dl>

<dl class="method">
<dt id="maketree">
<tt class="descname">maketree</tt><big>(</big><big>)</big><a class="headerlink" href="#maketree" title="Permalink to this definition">¶</a></dt>
<dd><p>Return a tree generated using the library&#8217;s configuration files.</p>
</dd></dl>

</div>
<div class="section" id="proxylibrary">
<h2>ProxyLibrary<a class="headerlink" href="#proxylibrary" title="Permalink to this headline">¶</a></h2>
<p>ProxyLibrary is a subclass of Library for virtual FUSE mounted
libraries.  It overrides the following methods:</p>
<dl class="method">
<dt>
<tt class="descname">fix</tt><big>(</big><big>)</big></dt>
<dd><p>Log a warning and do nothing. (Action not allowed.)</p>
</dd></dl>

<dl class="method">
<dt>
<tt class="descname">mount</tt><big>(</big><em>path</em>, <em>tree</em><big>)</big></dt>
<dd><p>Log a warning and do nothing. (Action not allowed.)</p>
</dd></dl>

</div>
</div>


          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h3><a href="../index.html">Table Of Contents</a></h3>
  <ul>
<li><a class="reference internal" href="#">Library Operations</a><ul>
<li><a class="reference internal" href="#baselibrary">BaseLibrary</a></li>
<li><a class="reference internal" href="#basefslibrary">BaseFSLibrary</a></li>
<li><a class="reference internal" href="#library">Library</a></li>
<li><a class="reference internal" href="#proxylibrary">ProxyLibrary</a></li>
</ul>
</li>
</ul>

  <h4>Previous topic</h4>
  <p class="topless"><a href="names.html"
                        title="previous chapter">Names and Paths</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="../changes.html"
                        title="next chapter">Changelog</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="../_sources/dev/libop.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../changes.html" title="Changelog"
             >next</a> |</li>
        <li class="right" >
          <a href="names.html" title="Names and Paths"
             >previous</a> |</li>
        <li><a href="../index.html">dantalian 0.4.1 documentation</a> &raquo;</li>
          <li><a href="../dev.html" >Developers Guide</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2013, darkfeline.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>